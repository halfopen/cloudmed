<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>健康自检</title>
		
		<script src="../js/mui.min.js"></script>
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/app.css" rel="stylesheet" />
		<link href="../css/report.css" rel="stylesheet" />
		<script src="../data/question.js" ></script>
		<script src="../js/angular.min.js"></script>
		<script src="../js/angular-animate.min.js"></script>
		<script src="../js/angular-aria.min.js"></script>
		<script src="../js/angular-messages.min.js"></script>

	</head>
	<body>
		<base href="/html/" />
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">检测报告</h1>
		</header>
		
		<div class="mui-content" ng-app="myApp" ng-controller="myCtrl">
			<div class="tip">
				您在{{date}}的体检报告
			</div>
			<div class="col-box">
				<div>面诊结果</div>
				<p>{{faceResult}}</p>
			</div>
			<div class="col-box">
				<div>舌诊结果</div>
				<p>{{tongueResult}}</p>
			</div>
			<div class="col-box">
				<div>结论： {{phy}} {{healthScore}}分</div>
				<p>{{healthState}} <img alt="" src="{{HEALTH_INDEX_IMAGE}}" style="width: 120px; height: 120px"></p>
			</div>

			<div class="col-box">
				<div>建议</div>
				<suggestion stype="{{stype}}"></suggestion>
			</div>
		</div>

		<script>
			var app = angular.module('myApp', []);
			app.config(['$locationProvider', function($locationProvider) {
				$locationProvider.html5Mode(true);
			}]);
			app.controller('myCtrl', function($scope, $location){
				$scope.faceResult = "无面诊记录";
				$scope.tongueResult = "无舌诊记录";
				$scope.healthState = "身体棒棒哒";
				// 建议类型
				$scope.stype = 7; // 健康
				$scope.date = Date();
				var faces = ["xiaolian.jpg", "xiaolian2.jpg", "pinglian.jpg", "pinglian2.jpg", "pinglian3.jpg", "kulian.jpg", "kulian2.jpg", "kulian3.jpg"];
				$scope.HEALTH_INDEX_IMAGE = "./resource/html/image/"+faces[0];

				if(undefined!= $location.search().data){
					console.log($location.search().data);
					var data = JSON.parse($location.search().data.replace(/'/g, ""));
					if(null!=data.faceResult){
						
					}
					if(null!=data.tongueResult){

					}
					$scope.phy = data.phy;
					$scope.healthScore = data.healthScore;
					$scope.HEALTH_INDEX_IMAGE = "./resource/html/image/"+faces[4-Math.floor(data.healthScore/25)];
					$scope.stype = data.mainType;
				}
			});
			app.directive('suggestion', function(){
				// 建议模板
				// "suggestion_xuexu.html"   ,好像没有血虚
				var templates = [
					"suggestion_yangxu.html",
					"suggestion_yinxu.html"  ,
					"suggestion_tanshi.html"  ,
					"suggestion_yuzhi.html", 
					"suggestion_pixu.html"  ,
					"suggestion_shenxu.html"  ,
					"suggestion_qixu.html"  ,
					"suggestion_zhengchang.html"];

				var url = templates[Math.floor(Math.random()*8)];
				//url = templates[1];
				console.log(url);
				return {
					template:'<div ng-include="getContentUrl()"></div>',
					replace: true,
					link: function($scope, $element, $attr){
						$scope.getContentUrl = function(){
							var template = "suggestions/"+templates[7];
							if(undefined != $attr.stype){
								template = "suggestions/"+templates[parseInt($attr.stype)];
							}
							return template;
						}
					}
				}
			});
			mui.init();
		</script>
	</body>
</html>
